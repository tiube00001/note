### 3.1性能优化简介
1.性能的定义：完成某项任务所需的时间度量，则：性能即响应时间

2.性能优化：在一定的负载下，尽可能的降低响应时间

3.优化的原则：无法测量就无法进行有效的优化

4.常见的错误测量情况：

    1.在错误的时间，启动和结束测量
    2.测量的是聚合后的信息，而不是目标活动本身

### 3.1.2通过性能剖析进行优化

1.性能剖析是测量和分析时间花费在哪里的主要方法

2.性能剖析的两个步骤：

    1.测量任务花费的时间
    2.对结果进行统计排序，将重要的任务排在前面
    
3.性能剖析的类型：

    1.基于执行时间的分析，研究什么任务执行时间最长
    2.基于等待的分析，判断任务在什么地方被阻塞的最久
    
### 3.2对应用程序进行性能剖析

性能瓶颈的常见因素：

    1.外部资源，比如调用了外部的web资源或者搜索引擎
    2.应用需要处理超大量的数据，比如分析一个超大的XML
    3.在循环中执行昂贵的操作，例如滥用正则
    4.使用了低效的算法，比如暴力搜索算法
    
工具推荐：

    1.New Relic（作者强烈推荐）
    2.xhprof (PHP，Facebook开源工具)
    3.IfP(instrutation for php) (作者开发的性能剖析工具)
    
### 3.3剖析Mysql查询

1.剖析整个数据库服务器，分析哪些查询是主要的压力来源

2.对慢查询进行单独剖析，分析哪些子任务是资源的主要消耗者

#### 3.3.1剖析服务器负载

1.慢查询日志，找出代价高的查询

    1.开启慢查询日志
    2.分析慢查询日志，（推荐，Percona Toolkit工具集中的pt-query-digest，mysqlsla，mysqldumpslow）

#### 3.3.2剖析单个查询
    1.show profile
    2.show status
    3.Perfomance schema(5.5还不大实用)
    
### 3.4诊断间歇性问题

##### 3.4.1确认是单查询问题，还是服务器问题

    1.高频率的使用：SHOW GLOBAL STATUS，例如每秒一次
    2.不停的捕获：SHOW PROCESSLIST的输出，来观察是否有大量线程有不正常的状态
    3.使用查询日志，（将慢查询扩展到全局级别）
    
#### 3.4.2捕获诊断数据
准备工作：

1.一个可靠且实时的“触发器”，也就是能区分什么时候问题会出现的方法（推荐工具pt-stalk）

2.一个收集诊断数据的工具

3.工具介绍：

    1.oprofile
    2.tcpdump(流量监测)
    3.GDB堆栈跟踪，gdb工具
    4.pt-pmp
    5.pt-collect(Percona Toolkit中的一个)
    6.pt-mysql-summary和pt-summary
    7.pt-sift
    
4.解释结果数据：

    1.检查问题是否发生
    2.是否有非常明显的跳跃性变化

    
